{
  "params": {
    "appName": "PushButton Sandbox",
    "version": "v123",
    "region": "us-east-1"
  },
  "args": [
    {
      "param": "version",
      "description": "Application version",
      "flag": "--appVersion",
      "type": "string"
    }
  ],
  "resources": [
    {
      "type": "GitArchiveProvider",
      "name": "git-repo",
      "actions": ["createResource"],
      "config": {}
    },
    {
      "type": "S3Bucket",
      "name": "pb-bucket",
      "actions": [],
      "config": {
        "bucketName": "turbine-eb"
      }
    },
    {
      "type": "S3Object",
      "name": "pb-archive-object",
      "actions": ["createResource"],
      "config": {
        "fileProvider": {"$ref": "resources.git-repo"},
        "bucket": {"$ref": "resources.pb-bucket"},
        "key": {"$ref": "tmpl!{{params.appName}}.{{params.version}}"}
      }
    },
    {
      "type": "AppVersion",
      "name": "pb-app-version",
      "actions": ["createResource"],
      "config": {
        "region": {"$ref": "params.region"},
        "ApplicationName": {"$ref": "params.appName"},
        "VersionLabel": {"$ref": "tmpl!{{params.appName}} - {{params.version}}"},
        "s3Object": {"$ref": "resources.pb-archive-object"}
      }
    },
    {
      "type": "SqsQueue",
      "name": "pb-queue",
      "actions": ["createResource"],
      "config": {
        "region": {"$ref": "params.region"},
        "queueName": {"$ref": "tmpl!pb-queue-{{params.version}}"},
        "attributes": {
          "Policy": {
            "$ref": "json!",
            "json": {
              "Statement": [
                {
                  "Effect": "Allow",
                  "Action": "SQS:*",
                  "Principal": {
                    "AWS": "arn:aws:iam::350421549183:user/turbine-sqs"
                  }
                }
              ]
            }
          }
        }
      }
    },
    {
      "type": "EbEnvironment",
      "name": "pb-eb-environment",
      "actions": ["createResource"],
      "config": {
        "applicationName": "PushButton Sandbox",
        "environmentName": {"$ref": "tmpl!push-button-{{params.version}}"},
        "appVersion": {"$ref": "resources.pb-app-version"},
        "region": {"$ref": "params.region"},
        "solutionStack": {
          "os": "64bit Amazon Linux",
          "stack": "PHP 5.5"
        },
        "tier": "WebServer",
        "cnamePrefix": {"$ref": "tmpl!push-button-{{params.version}}"},
        "environmentVars": {
          "FOO": "BAR",
          "SQS_QUEUE": {  "$ref": "resources.pb-queue.queueUrl" }
        }
      }
    },
    {
      "type": "EbEnvironment",
      "name": "pb-eb-worker",
      "actions": ["createResource"],
      "config": {
        "applicationName": "PushButton Sandbox",
        "environmentName": {"$ref": "tmpl!push-button-eng-{{params.version}}"},
        "appVersion": {"$ref": "resources.pb-app-version"},
        "region": {"$ref": "params.region"},
        "solutionStack": {
          "os": "64bit Amazon Linux",
          "stack": "PHP 5.5"
        },
        "tier": "Worker",
        "options": {
          "sqsWorker": {
            "sqsQueue": { "$ref": "resources.pb-queue" }
          }
        }
      }
    }
  ]
}